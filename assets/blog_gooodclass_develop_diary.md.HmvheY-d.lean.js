import{_ as a,c as i,a2 as n,o as e}from"./chunks/framework.BQmytedh.js";const p="/assets/structure.KJLmoYAu.png",g=JSON.parse('{"title":"开发过程","description":"","frontmatter":{},"headers":[],"relativePath":"blog/gooodclass_develop_diary.md","filePath":"blog/gooodclass_develop_diary.md"}'),t={name:"blog/gooodclass_develop_diary.md"};function l(h,s,k,d,r,o){return e(),i("div",null,s[0]||(s[0]=[n('<h2 id="体系架构" tabindex="-1">体系架构 <a class="header-anchor" href="#体系架构" aria-label="Permalink to &quot;体系架构&quot;">​</a></h2><p><img src="'+p+`" alt="structure"></p><h1 id="开发过程" tabindex="-1">开发过程 <a class="header-anchor" href="#开发过程" aria-label="Permalink to &quot;开发过程&quot;">​</a></h1><h2 id="后端开发" tabindex="-1">后端开发 <a class="header-anchor" href="#后端开发" aria-label="Permalink to &quot;后端开发&quot;">​</a></h2><p>首先进行后端开发，根据网上关于docker-easyconnect的使用教程，我首先得买一台Linux服务器，正好之前在哔哩哔哩上有人推荐的阿里云ecs，99元/年，虽然各大公司的云产品的价格相比几年前下降了不少，但我还是咬牙买下了一台 Ubuntu 18.04</p><h3 id="安装docker-easyconnect" tabindex="-1">安装docker-easyconnect <a class="header-anchor" href="#安装docker-easyconnect" aria-label="Permalink to &quot;安装docker-easyconnect&quot;">​</a></h3><p>1.首先安装docker</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://test.docker.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-docker.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-docker.sh</span></span></code></pre></div><p>2.安装docker-easyconnect</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-client</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-client-latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-common</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-latest-logrotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-logrotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-engine</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum-utils</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum-config-manager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-ce</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-ce-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd.io</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span></code></pre></div><p>3.启动docker-easyconnect服务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --device</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/net/tun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cap-add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NET_ADMIN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ti</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 127.0.0.1:1080:1080</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 127.0.0.1:8888:8888</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> EC_VER=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7.6.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CLI_OPTS=&quot;-d 教务系统ip -u 学号 -p 校园网密码&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hagb/docker-easyconnect:cli</span></span></code></pre></div><p>注意，这里的教务系统ip只能是ip格式，可以通过ping 命令来获取ip</p><p>现在<code>docker-easyconnect</code>就算部署成功</p><p>我们使用写一个python测试一下是否能正确访问教务系统</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requets</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">requests.post(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">headers,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">proxies</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;127.0.0.1:8888&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(r.statuscode)</span></span></code></pre></div><p>当statuscode为200时代表部署成功。</p><h3 id="flask搭建api" tabindex="-1">Flask搭建api <a class="header-anchor" href="#flask搭建api" aria-label="Permalink to &quot;Flask搭建api&quot;">​</a></h3><p>下一步是教务系统课表等内容的获取，这个在之前在编写原生Android版好好好课程表时候我已经使用python写好了，由于python也跨平台，我可以使用之前写的脚本。</p><p>获取到课程表数据之后我该如何以api的形式返回给客户端呢，我想到了Flask，由于之前部署在网页端的项目几乎都是用Flask搭建的，这个api的搭建对我来说也显得轻车熟路，</p><p>下面记录一下踩坑记录以及我是如何解决的</p><h4 id="_1-问题-linux端跑windows端写好的python代码出现编码错误问题" tabindex="-1">1.问题：linux端跑Windows端写好的python代码出现编码错误问题 <a class="header-anchor" href="#_1-问题-linux端跑windows端写好的python代码出现编码错误问题" aria-label="Permalink to &quot;1.问题：linux端跑Windows端写好的python代码出现编码错误问题&quot;">​</a></h4><p>解决：在python文件之前加上下面代码</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/usr/bin/python</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -*- coding: UTF-8 -*-</span></span></code></pre></div><h4 id="_2-问题-每次成功请求到一个用户的信息时-下载输入错误的信息仍然嗯请求得到" tabindex="-1">2.问题：每次成功请求到一个用户的信息时，下载输入错误的信息仍然嗯请求得到 <a class="header-anchor" href="#_2-问题-每次成功请求到一个用户的信息时-下载输入错误的信息仍然嗯请求得到" aria-label="Permalink to &quot;2.问题：每次成功请求到一个用户的信息时，下载输入错误的信息仍然嗯请求得到&quot;">​</a></h4><p>解决： 这个问题困扰我半天，我第一反应就是cookie的问题，但是误以为时Flask每次请求后保存的cookie，因为当我直接执行获取课表的py脚本时不会出现这个问题，我网上找了好多资料来清除Flask的cookie，都没有效果，山重水复之际，我将实现转到了py脚本，我尝试了在代码中连续模拟请求两次（不中断程序），结果问题复发了，这说明就是脚本自身问题与Flask无关。</p><p>在脚本中，我在结束位置加入以下代码</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> session.cookies.clear()</span></span></code></pre></div><p>清除cookie，最终问题得到解决</p><h4 id="_3-api的健壮性" tabindex="-1">3.API的健壮性 <a class="header-anchor" href="#_3-api的健壮性" aria-label="Permalink to &quot;3.API的健壮性&quot;">​</a></h4><p>当输入表单信息有误时，可能会触发500错误，根据Flask的报错信息，我发现时由于代码中没有做异常处理，于是我对代码进行优化，在可能出现错误的地方进行了判断，极大提高了api的健壮性与容错能力</p><h4 id="_4-在使用flask-run启动flask服务时-会显示warning" tabindex="-1">4.在使用flask run启动Flask服务时，会显示warning <a class="header-anchor" href="#_4-在使用flask-run启动flask服务时-会显示warning" aria-label="Permalink to &quot;4.在使用flask run启动Flask服务时，会显示warning&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Debug</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mode:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WARNING:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> This</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> development</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Do</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> production</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> production</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WSGI</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> instead.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Running</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:5000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Press</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CTRL+C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quit</span></span></code></pre></div><p>这些都是由于flask没有运行在稳定的环境</p><p>我们可以使用<code>Gunicorn</code>来帮忙</p><p>安装Gunicorn</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pip install gunicorn</span></span></code></pre></div><p>使用Gunicorn来启动flask服务</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gunicorn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">b </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.0.0:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app:app</span></span></code></pre></div><h4 id="_5-在命令行中启动服务-退出时会导致服务终止" tabindex="-1">5.在命令行中启动服务，退出时会导致服务终止 <a class="header-anchor" href="#_5-在命令行中启动服务-退出时会导致服务终止" aria-label="Permalink to &quot;5.在命令行中启动服务，退出时会导致服务终止&quot;">​</a></h4><p>我们需要安装进程管理软件实现的进程管理，使得在推出服务器之后服务仍然能正常运行，我们这里使用Supervisor</p><ol><li><p>安装 Supervisor：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo apt-get install supervisor</span></span></code></pre></div></li><li><p>创建一个新的 Supervisor 配置文件：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo nano /etc/supervisor/conf.d/gunicorn.conf</span></span></code></pre></div></li><li><p>在配置文件中添加以下内容（根据您的设置进行修改）：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[program:gunicorn]</span></span>
<span class="line"><span>command=/path/to/your/virtualenv/bin/gunicorn -b 0.0.0.0:5000 app:app</span></span>
<span class="line"><span>directory=/path/to/your/app/directory</span></span>
<span class="line"><span>user=root</span></span>
<span class="line"><span>autostart=true</span></span>
<span class="line"><span>autorestart=true</span></span>
<span class="line"><span>redirect_stderr=true</span></span>
<span class="line"><span>stdout_logfile=/var/log/gunicorn.log</span></span></code></pre></div><p>确保将上述命令和路径配置为适合您的环境。</p></li><li><p>保存并关闭文件。</p></li><li><p>更新 Supervisor 配置并启动进程：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo supervisorctl reread</span></span>
<span class="line"><span>sudo supervisorctl update</span></span>
<span class="line"><span>sudo supervisorctl start gunicorn</span></span></code></pre></div><p>这将读取新的配置文件、更新 Supervisor 并启动 <code>gunicorn</code> 进程。</p></li></ol><p>现在，<code>gunicorn</code> 进程将由 Supervisor 管理，并且会在系统启动时自动启动。可以使用 <code>supervisorctl</code> 命令来管理进程，例如停止、重启或查看进程状态：</p><div class="language-pythn vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pythn</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo supervisorctl stop gunicorn</span></span>
<span class="line"><span>sudo supervisorctl restart gunicorn</span></span>
<span class="line"><span>sudo supervisorctl status</span></span></code></pre></div><h4 id="_6-api在外网无法访问" tabindex="-1">6.API在外网无法访问 <a class="header-anchor" href="#_6-api在外网无法访问" aria-label="Permalink to &quot;6.API在外网无法访问&quot;">​</a></h4><p>这里要指定flask服务运行在0.0.0.0</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gunicorn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">b </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.0.0:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app:app</span></span></code></pre></div><p>并且由于阿里云的安全策略，我们需要在<code>安全组</code>中开放5000端口</p><h4 id="_7-重新进入服务器非重启关闭服务" tabindex="-1">7.重新进入服务器非重启关闭服务 <a class="header-anchor" href="#_7-重新进入服务器非重启关闭服务" aria-label="Permalink to &quot;7.重新进入服务器非重启关闭服务&quot;">​</a></h4><p>先使用</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tunlp</span></span></code></pre></div><p>查看当前运行的服务以及端口</p><p>强制关闭</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pid</span></span></code></pre></div><p>这样外网就能访问到啦</p><h2 id="前端开发" tabindex="-1">前端开发 <a class="header-anchor" href="#前端开发" aria-label="Permalink to &quot;前端开发&quot;">​</a></h2><p>基于flutter开发课程表的原因就是因为其跨平台特性，可以运行在web，ios，Windows以及Android端，这样可以极大可能收获用户。</p><p>下面记录flutter开发过程中的踩过的坑</p><h3 id="_1-修改flutterapp应用工程名称为gooodclaas之后-build异常" tabindex="-1">1.修改flutterapp应用工程名称为gooodclaas之后，build异常 <a class="header-anchor" href="#_1-修改flutterapp应用工程名称为gooodclaas之后-build异常" aria-label="Permalink to &quot;1.修改flutterapp应用工程名称为gooodclaas之后，build异常&quot;">​</a></h3><p>这时候只要在终端输入</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flutter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean</span></span></code></pre></div><h3 id="_2-flutter-android-网络权限问题" tabindex="-1">2.flutter android 网络权限问题 <a class="header-anchor" href="#_2-flutter-android-网络权限问题" aria-label="Permalink to &quot;2.flutter android 网络权限问题&quot;">​</a></h3><p>在调试(debug)模式下不需要网络权限也能获取到课程数据，但是当发布为realease版本后，需要在app manifest 文件中加入网络权限（跟Android原生开发类似）</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses-permission</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.permission.INTERNET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span></code></pre></div><p>这样app才能成功访问到网络.</p><h3 id="_3-flutter-android签名问题" tabindex="-1">3.flutter android签名问题 <a class="header-anchor" href="#_3-flutter-android签名问题" aria-label="Permalink to &quot;3.flutter android签名问题&quot;">​</a></h3><p>安卓应用发布都需要签名，而我开发的app都使用的我的签名pwxiao.jks，该签名创建后保存在了我的设备上，现在需要使用这个签名对我的flutter app进行签名</p><p>这个过程在官网有教程</p><h4 id="从-app-中引用密钥库" tabindex="-1">从 app 中引用密钥库 <a class="header-anchor" href="#从-app-中引用密钥库" aria-label="Permalink to &quot;从 app 中引用密钥库&quot;">​</a></h4><p>创建一个名为 <code>[project]/android/key.properties</code> 的文件，它包含了密钥库位置的定义。在替换内容时请去除 <code>&lt; &gt;</code> 括号：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>storePassword=&lt;password-from-previous-step&gt;</span></span>
<span class="line"><span>keyPassword=&lt;password-from-previous-step&gt;</span></span>
<span class="line"><span>keyAlias=upload</span></span>
<span class="line"><span>storeFile=&lt;keystore-file-location&gt;</span></span></code></pre></div><p><code>storeFile</code> 在 Windows 上类似于 <code>C:\\\\Users\\\\&lt;user name&gt;\\\\upload-keystore.jks</code>。</p><h4 id="在-gradle-中配置签名" tabindex="-1">在 gradle 中配置签名 <a class="header-anchor" href="#在-gradle-中配置签名" aria-label="Permalink to &quot;在 gradle 中配置签名&quot;">​</a></h4><p>在以 release 模式下构建你的应用时，修改 <code>[project]/android/app/build.gradle</code> 文件，以通过 gradle 配置你的上传密钥。</p><ol><li><p>在 <code>android</code> 代码块之前将你 properties 文件的密钥库信息添加进去：</p><p><em>content_copy</em></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>   def keystoreProperties = new Properties()</span></span>
<span class="line"><span>   def keystorePropertiesFile = rootProject.file(&#39;key.properties&#39;)</span></span>
<span class="line"><span>   if (keystorePropertiesFile.exists()) {</span></span>
<span class="line"><span>       keystoreProperties.load(new FileInputStream(keystorePropertiesFile))</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>   android {</span></span>
<span class="line"><span>         ...</span></span>
<span class="line"><span>   }</span></span></code></pre></div><p>将 <code>key.properties</code> 文件加载到 <code>keystoreProperties</code> 对象中。</p></li><li><p>找到 <code>buildTypes</code> 代码块：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>   buildTypes {</span></span>
<span class="line"><span>       release {</span></span>
<span class="line"><span>           // TODO: Add your own signing config for the release build.</span></span>
<span class="line"><span>           // Signing with the debug keys for now,</span></span>
<span class="line"><span>           // so \`flutter run --release\` works.</span></span>
<span class="line"><span>           signingConfig signingConfigs.debug</span></span>
<span class="line"><span>       }</span></span>
<span class="line"><span>   }</span></span></code></pre></div><p>将其替换为我们的配置内容：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>   signingConfigs {</span></span>
<span class="line"><span>       release {</span></span>
<span class="line"><span>           keyAlias keystoreProperties[&#39;keyAlias&#39;]</span></span>
<span class="line"><span>           keyPassword keystoreProperties[&#39;keyPassword&#39;]</span></span>
<span class="line"><span>           storeFile keystoreProperties[&#39;storeFile&#39;] ? file(keystoreProperties[&#39;storeFile&#39;]) : null</span></span>
<span class="line"><span>           storePassword keystoreProperties[&#39;storePassword&#39;]</span></span>
<span class="line"><span>       }</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>   buildTypes {</span></span>
<span class="line"><span>       release {</span></span>
<span class="line"><span>           signingConfig signingConfigs.release</span></span>
<span class="line"><span>       }</span></span>
<span class="line"><span>   }</span></span></code></pre></div></li></ol><p>现在flutter app 的发布版本就会被自动签名了。</p><h4 id="_4-flutter-web在某些浏览器中获取课程表失败的问题" tabindex="-1">4.flutter web在某些浏览器中获取课程表失败的问题 <a class="header-anchor" href="#_4-flutter-web在某些浏览器中获取课程表失败的问题" aria-label="Permalink to &quot;4.flutter web在某些浏览器中获取课程表失败的问题&quot;">​</a></h4><p>当部署到vercel服务器时，网站会采用https加密，但是获取课表过程中需要向我的服务器请求数据，而我的服务器使用的http协议，没有使用https加密，而有些浏览器（目前已知的有chrome,edge,safari）的安全策略比较严格，会组织这种请求</p><p>console输出如下：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">main.dart.js:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">40476</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Mixed </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: The page at </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://app.pwxiao.top/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> was loaded over </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HTTPS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, but requested an insecure XMLHttpRequest endpoint </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://xxxxxxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">. This request has been blocked; the content must be served over </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HTTPS</span></span></code></pre></div><p>目前暂未解决这个问题，网上提到使用nignx反向代理，获取以后会解决</p><h4 id="_5-flutter-类型转换的问题" tabindex="-1">5.flutter 类型转换的问题 <a class="header-anchor" href="#_5-flutter-类型转换的问题" aria-label="Permalink to &quot;5.flutter 类型转换的问题&quot;">​</a></h4><p>dart语言中</p><p>在写一周课表功能的过程中，我发现在web平台能正确加载，而在Android平台则会抛出异常，我通过debug将问题锁定在了下面这一行代码</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VisualstartJie</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((startJie</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>这段代码一开始我想的是根据课程json中的startJie转换成他在课程表中竖列的坐标，</p><p>一开始是这样</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VisualstartJie</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((startJie</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>但这样可能会有一个问题，当startJie为偶数时，((startJie-1)/2)的值会是浮点数，ide也给出了错误提示，<code>A value of type &#39;double&#39; can&#39;t be assigned to a variable of type &#39;int&#39;. </code>于是我通过ide的自动修复在代码后面加上了<code>as int</code>，这样没有报错，web平台也正常和运行，但是很奇怪这样在Android平台是跑不成的,当我将代码写成</p><div class="language-dart vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VisualstartJie</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((startJie</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>则能跑通，暂时还不明白两个平台在这方面有什么区别.</p><h4 id="_6-每周课表中每门课专属颜色" tabindex="-1">6.每周课表中每门课专属颜色 <a class="header-anchor" href="#_6-每周课表中每门课专属颜色" aria-label="Permalink to &quot;6.每周课表中每门课专属颜色&quot;">​</a></h4><p>颜色应该跟课程名称挂钩，这里使用material.pramary配色，我的方案是取课程名称的hashcode,再对18（也就是配色列表长度）取模，再通过这个值匹配到配色列表中的元素，虽然这样还是可能会出现不同课程配色一样的问题，但是效果上还是符合预期的</p><h4 id="_7-flutter-android-的自动更新问题" tabindex="-1">7.flutter android 的自动更新问题 <a class="header-anchor" href="#_7-flutter-android-的自动更新问题" aria-label="Permalink to &quot;7.flutter android 的自动更新问题&quot;">​</a></h4><p>Android app不同于网站，不会自动更新，，需要自己编写更新功能，再flutter项目中，会创建有Android项目供自定义安卓端的内容，正好我是从原生安卓转Flutter，并且在之前原生安卓版的好好好课程表项目已经编写了这一功能，故可以直接使用之前的代码。不过还是遇到有一些问题，下面是详细步骤</p><p>在之前的更新代码中用到了okhttpy以及json处理等库，在flutter项项目中这些库需要我们自己添加</p><p>1.找到moudule为app的build.gradle，添加</p><div class="language-gradle vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">gradle</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>dependencies {</span></span>
<span class="line"><span>    implementation &#39;androidx.annotation:annotation:1.7.1&#39;</span></span>
<span class="line"><span>    ...这里添加你需要导入的库</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>点击sync now</p><p>暂未完结，更新中。。。。。</p>`,100)]))}const F=a(t,[["render",l]]);export{g as __pageData,F as default};
