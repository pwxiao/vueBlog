import{_ as s,c as a,o as i,a4 as n}from"./chunks/framework.B5RDkS33.js";const c=JSON.parse('{"title":"基于Vercel和Flask部署API","description":"","frontmatter":{},"headers":[],"relativePath":"blog/vercel_deploy_api.md","filePath":"blog/vercel_deploy_api.md"}'),t={name:"blog/vercel_deploy_api.md"},p=n(`<h1 id="基于vercel和flask部署api" tabindex="-1">基于Vercel和Flask部署API <a class="header-anchor" href="#基于vercel和flask部署api" aria-label="Permalink to &quot;基于Vercel和Flask部署API&quot;">​</a></h1><p>项目地址：<a href="https://github.com/pwxiao/MyWords_API" target="_blank" rel="noreferrer">https://github.com/pwxiao/MyWords_API</a></p><h2 id="引言" tabindex="-1">引言 <a class="header-anchor" href="#引言" aria-label="Permalink to &quot;引言&quot;">​</a></h2><p>前段时间无意间发现了Vercel这个平台，它可以免费部署服务器和托管网站，与GithubPages只能托管静态网站不同，vercel可以部署的内容有很多，它支持python，go等多语言环境，这意味你可以创建动态的内容，甚至，你可以在上面部署一个深度学习模型。</p><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><p>Vercel有一个Serverless Function 功能，翻译过来就是<code>无服务器函数</code>,因此，通过这个功能，我们可以在Vercel部署我们的api，我们今天这个项目就是基于Vercel部署的。</p><p>这个项目名字叫做MyWords_API,通过对服务器进行<code>GET</code>请求，你会得到随机返回的一个句子，重新请求，句子也会随之刷新。</p><p>为了更直观的体验，你可以点击<a href="https://api.pwxiao.top/" target="_blank" rel="noreferrer">https://api.pwxiao.top/</a>。</p><p>另外这个api还支持更多的功能，具体操作请查看项目的<a href="https://github.com/pwxiao/MyWords_API" target="_blank" rel="noreferrer">README.md</a>文件。</p><h2 id="开发过程中遇到的坑" tabindex="-1">开发过程中遇到的坑 <a class="header-anchor" href="#开发过程中遇到的坑" aria-label="Permalink to &quot;开发过程中遇到的坑&quot;">​</a></h2><h3 id="多路由" tabindex="-1">多路由 <a class="header-anchor" href="#多路由" aria-label="Permalink to &quot;多路由&quot;">​</a></h3><p>我们可能会设置不同的路由已使用不同的api接口，但是官方的路由只支持对主页进行请求 ，对此我们只需要修改源代码中的vercel.json文件 将默认的vercel.json修改为</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;rewrites&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/(.*)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;destination&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>!!! info &quot;注意&quot; <code>destination</code>中的app，为你创建的flask_app的名称，按需修改</p><h3 id="文件读取" tabindex="-1">文件读取 <a class="header-anchor" href="#文件读取" aria-label="Permalink to &quot;文件读取&quot;">​</a></h3><p>在函数如果涉及到文件读取，我试过通过文件的open()函数来读取，这种方法在本地调试时是可行的，但是部署到vercel端时会出现<code>500</code>错误，暂时不知错误的原因，解决办法就是通过部署到vercel的文件的网络路径，使用requests.get()获取源代码，这样也能获取到文件的内容</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">requests.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://api.pwxiao.top/sentences/category.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json.loads(text)</span></span></code></pre></div><h3 id="json返回中文乱码" tabindex="-1">json返回中文乱码 <a class="header-anchor" href="#json返回中文乱码" aria-label="Permalink to &quot;json返回中文乱码&quot;">​</a></h3><p>在默认情况下，vercel会将内容转化为ASCII码输出，这样获取的内容只需要通过转码就可以了，但是在浏览器访问时不太美观，例如下面这样</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1082</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;uuid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ab89b12e-359b-4cfe-b50d-de35a20bf928&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;hitokoto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\u4f17\\u91cc\\u5bfb\\u4ed6\\u5343\\u767e\\u5ea6\\uff0c\\u84e6\\u7136\\u56de\\u9996\\uff0c\\u90a3\\u4eba\\u5374\\u5728\\uff0c\\u706f\\u706b\\u9611\\u73ca\\u5904\\u3002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;i&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;from&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\u9752\\u7389\\u6848</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">%b7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\u5143\\u5915</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;from_who&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;creator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;131&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;creator_uid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">146</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;reviewer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;commit_from&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1481559051&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;length&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>我们需要他显示成这样</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1082</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;uuid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ab89b12e-359b-4cfe-b50d-de35a20bf928&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;hitokoto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;i&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;from&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;青玉案·元夕&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;from_who&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;creator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;131&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;creator_uid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">146</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;reviewer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;commit_from&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1481559051&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;length&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><p>这时只需要将原内容进行一次json.dumps()转换并声明<code>ensure_ascii=False</code></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fina_res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json.dumps(result,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ensure_ascii</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="api的使用与部署" tabindex="-1">API的使用与部署 <a class="header-anchor" href="#api的使用与部署" aria-label="Permalink to &quot;API的使用与部署&quot;">​</a></h2><p>该API分为两个功能</p><h3 id="随机生成一句" tabindex="-1">随机生成一句 <a class="header-anchor" href="#随机生成一句" aria-label="Permalink to &quot;随机生成一句&quot;">​</a></h3><p>请求地址：</p><div class="language-url vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>https://api.pwxiao.top/</span></span></code></pre></div><p>参数说明：<em><a href="https://api.pwxiao.top?catogory=" target="_blank" rel="noreferrer">https://api.pwxiao.top?catogory=</a></em></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>’Anime&#39;:动画,</span></span>
<span class="line"><span>&#39;Comic&#39;:漫画,</span></span>
<span class="line"><span>&#39;Game&#39;:游戏,</span></span>
<span class="line"><span>&#39;Literature&#39;:文学,</span></span>
<span class="line"><span>&#39;Original&#39;:原创,</span></span>
<span class="line"><span>&#39;Internet&#39;:来源网络,</span></span>
<span class="line"><span>&#39;Other&#39;:其他,</span></span>
<span class="line"><span>&#39;Video&#39;:影视,</span></span>
<span class="line"><span>&#39;Poem&#39;:古诗文,</span></span>
<span class="line"><span>&#39;NCM&#39;:网易云,</span></span>
<span class="line"><span>&#39;Philosophy&#39;:哲学,</span></span>
<span class="line"><span>&#39;Funny&#39;:搞笑</span></span></code></pre></div><blockquote><p>数据库来自<a href="https://github.com/hitokoto-osc/sentences-bundle" target="_blank" rel="noreferrer">一言数据库</a></p></blockquote><p>返回值：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;id&quot;: 1263,</span></span>
<span class="line"><span>    &quot;uuid&quot;: &quot;a58936ac-f3fb-4e5d-838e-a77a7219d1a4&quot;,</span></span>
<span class="line"><span>    &quot;hitokoto&quot;: &quot;渔舟唱晚，响穷彭蠡之滨；雁阵惊寒，声断衡阳之浦。&quot;,</span></span>
<span class="line"><span>    &quot;type&quot;: &quot;i&quot;,</span></span>
<span class="line"><span>    &quot;from&quot;: &quot;滕王阁序&quot;,</span></span>
<span class="line"><span>    &quot;from_who&quot;: null,</span></span>
<span class="line"><span>    &quot;creator&quot;: &quot;毛毛毛布斯&quot;,</span></span>
<span class="line"><span>    &quot;creator_uid&quot;: 562,</span></span>
<span class="line"><span>    &quot;reviewer&quot;: 0,</span></span>
<span class="line"><span>    &quot;commit_from&quot;: &quot;web&quot;,</span></span>
<span class="line"><span>    &quot;created_at&quot;: &quot;1507184994&quot;,</span></span>
<span class="line"><span>    &quot;length&quot;: 24</span></span>
<span class="line"><span>  }</span></span></code></pre></div><h3 id="搜索古诗" tabindex="-1">搜索古诗 <a class="header-anchor" href="#搜索古诗" aria-label="Permalink to &quot;搜索古诗&quot;">​</a></h3><p>请求地址:</p><div class="language-url vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>https://api.pwxiao.top/search/</span></span></code></pre></div><p>参数说明：<em><a href="https://api.pwxiao.top/search/?s=query" target="_blank" rel="noreferrer">https://api.pwxiao.top/search/?s=query</a></em></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>query为要搜索的内容</span></span></code></pre></div><h3 id="使用vercel一键部署" tabindex="-1">使用Vercel一键部署 <a class="header-anchor" href="#使用vercel一键部署" aria-label="Permalink to &quot;使用Vercel一键部署&quot;">​</a></h3><p>  点击下方按钮根据提示操作即可</p><p>  <a href="https://vercel.com/new/clone?repository-url=https://github.com/pwxiao/MyWords_API" target="_blank" rel="noreferrer"><img src="https://www.datocms-assets.com/31049/1618983297-powered-by-vercel.svg" alt="Powered by Vercel"></a></p>`,42),e=[p];function l(h,k,o,r,d,E){return i(),a("div",null,e)}const g=s(t,[["render",l]]);export{c as __pageData,g as default};
